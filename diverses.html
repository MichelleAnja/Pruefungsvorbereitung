<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Theoriefragen Allgemein Berichterstattung</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url("hintergrund.jpg") no-repeat center center fixed;
      background-size: cover;
      margin: 0; padding: 40px 20px; color:#000;
    }
    .section {
      background: rgba(255,255,255,0.92);
      border-radius: 12px;
      padding: 20px;
      margin: 20px auto;
      max-width: 1000px;
    }
    h1 { font-size: 22px; margin: 0 0 12px; }
    h2 { font-size: 18px; margin: 16px 0 8px; }

    .input-box { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .input-box input {
      flex:1; padding:10px; border-radius:6px; border:2px solid #ccc; font-size:16px;
    }
    .input-box button {
      padding:10px 16px; border:none; border-radius:6px; background:#000; color:#fff; cursor:pointer; font-size:16px;
    }

    .options { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
    .options button { padding:10px 16px; border:none; border-radius:6px; background:#000; color:#fff; cursor:pointer; font-size:16px; }

    .correct { background:lightgreen !important; color:#000 !important; }
    .wrong   { background:lightcoral !important; color:#000 !important; }
    .explanation { margin-top:6px; display:none; font-weight:bold; color:#000; }

    .back-link {
      display:inline-block; margin-bottom:20px;
      font-size:18px; font-weight:bold; color:#000; text-decoration:none;
    }

    @media (max-width:480px){
      body{padding:24px 12px;}
      h1{font-size:20px;} h2{font-size:16px;}
    }
  </style>
</head>
<body>
  <div class="section">
    <a href="revision.html" class="back-link">← Zurück</a>
    <h1>Theoriefragen Allgemein Berichterstattung</h1>
  </div>

  <div id="quiz-container"></div>

  <script>
    // ——— Hilfsfunktionen ———
    function normalize(text){
      return (text||"")
        .toLowerCase()
        .replace(/\s+/g,"")
        .replace(/[.,;:!?()„“"']/g,"")
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"");
    }
    // Levenshtein für leichte Tippfehler
    function lev(a,b){
      const m=a.length,n=b.length;
      const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i;
      for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){
        for(let j=1;j<=n;j++){
          const cost=a[i-1]===b[j-1]?0:1;
          dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
        }
      }
      return dp[m][n];
    }
    function closeMatch(user, correct){
      const u=normalize(user), c=normalize(correct);
      if(!u) return false;
      if(u===c) return true;
      const d=lev(u,c);
      const len=Math.max(3,c.length);
      const tol = Math.max(1, Math.round(len*0.1)); // ~10% Toleranz
      return d<=tol;
    }

    function checkWord(inputId, correctWord, feedbackId, explanation=""){
      const input=document.getElementById(inputId);
      const fb=document.getElementById(feedbackId);
      fb.innerHTML="";

      if(closeMatch(input.value, correctWord)){
        input.classList.add("correct"); input.classList.remove("wrong");
        fb.style.display="block"; fb.textContent="Richtig! ✅";
      } else {
        input.classList.add("wrong"); input.classList.remove("correct");
        input.value = correctWord; // richtige Lösung anzeigen
        fb.style.display="block"; fb.textContent="Falsch. Richtige Antwort: " + correctWord;
      }
      if(explanation){
        const extra=document.createElement("div");
        extra.className="explanation";
        extra.style.display="block";
        extra.textContent=explanation;
        fb.appendChild(extra);
      }
    }

    function selectOptionGroup(groupId, correctIndex, clickedIndex, explanation=""){
      const buttons=document.querySelectorAll(`[data-group='${groupId}']`);
      buttons.forEach((btn,i)=>{
        btn.disabled=true;
        if(i===correctIndex) btn.classList.add("correct");
        if(i===clickedIndex && i!==correctIndex) btn.classList.add("wrong");
      });
      const fb=document.getElementById("f_"+groupId);
      if(explanation){ fb.style.display="block"; fb.innerHTML=explanation; }
    }

    // ——— Aufgaben ———
    const tasks = [
      { q:"1.\tIn welcher Reihenfolge sind Einschränkungen, Zusatz und Hinweise in dem Revisionsbericht zu erwähnen?", id:"q1", type:"text",
        answer:`1. Einschränkungen\n2. Zusatz\n3. Hinweis` },

      { q:"2.\tSind die Einschränkungen vor oder nach der Prüfungsaussage in den Revisionsbericht zu nehmen?", id:"q2", type:"mc",
        options:["vor","nach"], correct:0 },

      { q:"3.\tWie ist vorzugehen, wenn mehrere Tatbestände zu einer Einschränkung vorliegen?", id:"q3", type:"text",
        answer:"Die Prüfungsaussage bezieht sich auf die schwerwiegendste Einschränkung." },

      { q:"4.\tIst ein Zusatz vor oder nach der Prüfungsaussage in den Revisionsbericht zu nehmen?", id:"q4", type:"mc",
        options:["vor","nach"], correct:1 },

      { q:"5.\tWelche Arten von Einschränkungen gibt es?", id:"q5", type:"text",
        answer:`1. Eingeschränkte Prüfungsaussage\n2. Verneinende Prüfungsaussage\n3. Unmöglichkeit einer Prüfungsaussage` },

      { q:"6.\tWelche Arten einer Eingeschränkten Prüfungsaussage gibt es?", id:"q6", type:"text",
        answer:`1. Meinungsverschiedenheit festgestellter Sachverhalt\n2. Meinungsverschiedenheit angenommener Sachverhalt, NICHT grundlegend\n3. Beschränkung Prüfungsumfang, NICHT grundlegend` },

      { q:"7.\tWelche Arten einer verneinenden Prüfungsaussage gibt es?", id:"q7", type:"text",
        answer:"Meinungsverschiedenheit, festgestellter Sachverhalt, grundlegend" },

      { q:"8.\tWelche Arten von Unmöglichkeit einer Prüfungsaussage gibt es?", id:"q8", type:"text",
        answer:`1. Meinungsverschiedenheit, angenommener Sachverhalt, grundlegend\n2. Beschränkung des Prüfungsumfangs, grundlegend` },

      { q:"9.\tWann muss eine Einschränkung vorgenommen werden?", id:"q9", type:"text",
        answer:`1. Beschränkung des Prüfungsumfangs\n2. Verstoss gegen die Bewertungsgrundsätze\n3. Verstoss gegen die Darstellung (Mindestgliederung)\n4. Verstoss gegen die Offenlegung (Anhang)\n5. Verstoss gegen Grundsätze ordnungsmässiger Rechnungslegung` },

      { q:"10.\tWann ist ein Fehler grundlegend? Wenn durch die Korrektur des Fehlers folgendes passiert:", id:"q10", type:"text",
        answer:`1. ½ Kapitalverlust\n2. Überschuldung\n3. Dividendenauszahlung nicht mehr möglich\n4. Vielfaches der Gesamtwesentlichkeit` },

      { q:"11.\tWas ist eine Einschränkung?", id:"q11", type:"text",
        answer:`- Sie modifiziert die Prüfungsaussage.\n- Der Prüfer ist nicht in allen wesentlichen Punkten einverstanden.` },

      { q:"12.\tWas ist ein Zusatz?", id:"q12", type:"text",
        answer:`- Hervorhebung eines wichtigen Sachverhalts\n- Ergänzt den Bericht zur Vermeidung von Missverständnissen\n- Bezieht sich auf Prüfung, darf keine Geheimhaltung verletzen` },

      { q:"13.\tWas ist ein Hinweis?", id:"q13", type:"text",
        answer:`- Verstösse gegen andere gesetzliche Vorschriften in der Jahresrechnung\n- Kein Einfluss auf die Prüfungsaussage` },

      { q:"14.\tWas sind Beispiele einer redaktionellen Erläuterung? (SER 136-137)", id:"q14", type:"text",
        answer:`- Doppelmandat\n- Überlanges / verkürztes Geschäftsjahr\n- Vorjahr Opting-out\n- Vorjahr andere Revisionsgesellschaft\n- falls Vergleichszahlen nicht geprüft werden\n- Beilagen (GFR), falls diese von angewendeter Rechnungslegung vorgesehen wird` },

      { q:"15.\tWas ist der Inhalt im Revisionsbericht bei der eingeschränkten Revision? Art. 729b OR", id:"q15", type:"text",
        answer:`- Hinweis auf eingeschränkte Natur der Revision\n- Stellungnahme zum Ergebnis der Prüfung\n- Angaben zur Unabhängigkeit (allenfalls Doppelmandat)\n- Angaben zum leitenden Revisor inkl. Zulassung` }
    ];

    // ——— Rendern ———
    const container = document.getElementById("quiz-container");

    tasks.forEach(t=>{
      const sec=document.createElement("div"); sec.className="section";
      const h=document.createElement("h2"); h.textContent=t.q; sec.appendChild(h);

      if(t.type==="mc"){
        const opts=document.createElement("div"); opts.className="options";
        t.options.forEach((opt,i)=>{
          const btn=document.createElement("button");
          btn.innerText=opt; btn.dataset.group=t.id;
          btn.onclick=()=>selectOptionGroup(t.id, t.correct, i, t.expl || "");
          opts.appendChild(btn);
        });
        sec.appendChild(opts);
        const fb=document.createElement("div"); fb.id="f_"+t.id; fb.className="explanation"; sec.appendChild(fb);
      } else {
        const box=document.createElement("div"); box.className="input-box";
        box.innerHTML = `
          <input id="${t.id}" type="text" placeholder="Antwort eingeben..."/>
          <button onclick="checkWord('${t.id}', \`${t.answer}\`, 'f_${t.id}', \`${t.expl||""}\`)">OK</button>
        `;
        sec.appendChild(box);
        const fb=document.createElement("div"); fb.id="f_"+t.id; fb.className="explanation"; sec.appendChild(fb);
      }

      container.appendChild(sec);
    });
  </script>
</body>
</html>
